<!doctype html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Bienvenidos a nuestra lista de sugerencias" />
  <!-- Open Graph -->
  <meta property="og:title" content="Bienvenidos" />
  <meta property="og:description" content="Bienvenidos a nuestra lista de sugerencias" />
  <meta property="og:image" content="https://luendz.github.io/ListaDeSugerencias/banner.webp" />
  <meta property="og:url" content="https://luendz.github.io/ListaDeSugerencias/" />
  <meta property="og:type" content="website" />

  <!-- Opcional para WhatsApp/Twitter -->
  <meta name="twitter:card" content="summary_large_image" />

  <title>Sugerencias Baby Shower - Luan</title>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Quicksand:wght@400;700&display=swap"
    rel="stylesheet" />
  <style>
    :root {
      --shrek-green: #c4d300;
      --soft-green: #e8f5e9;
      --brown-vest: #5c4033;
      --swamp-dark: #4a5d23;
      --cream: #fff9e3;
    }

    body {
      font-family: "Quicksand", sans-serif;
      background-color: var(--soft-green);
      background-image: radial-gradient(circle, #dcedc8 1px, transparent 1px);
      background-size: 20px 20px;
      color: #333;
      margin: 0;
      padding: 0;
    }

    /* --- Modal --- */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(74, 93, 35, 0.8);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 2000;
      backdrop-filter: blur(8px);
    }

    .modal-content {
      background: var(--cream);
      padding: 30px;
      border-radius: 40px;
      max-width: 450px;
      width: 85%;
      text-align: center;
      border: 8px solid var(--shrek-green);
      box-shadow: 0 15px 0 var(--brown-vest);
      animation: bounceIn 0.6s ease;
    }

    .modal-content img {
      width: 180px;
      margin-bottom: 15px;
      border-radius: 20px;
    }

    /* --- Header --- */
    header {
      background-color: var(--shrek-green);
      padding: 40px 20px;
      text-align: center;
      border-bottom: 10px solid var(--brown-vest);
    }

    .img-bienvenidos {
      max-width: 600px;
      width: 100%;
      height: auto;
      filter: drop-shadow(0 5px 5px rgba(0, 0, 0, 0.2));
      margin-bottom: 10px;
    }

    /* --- Cuadro de Sugerencia --- */
    .sugerencia-container {
      max-width: 800px;
      margin: 30px auto;
      padding: 25px;
      background-color: var(--cream);
      border: 3px dashed var(--swamp-dark);
      border-radius: 20px;
      text-align: center;
    }

    .sugerencia-text {
      font-size: 1.1rem;
      line-height: 1.6;
      color: var(--brown-vest);
      font-weight: 600;
      margin: 0;
    }

    /* --- Grid de Regalos --- */
    .container {
      max-width: 1100px;
      margin: 20px auto 50px auto;
      padding: 0 20px;
    }

    .gift-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 25px;
    }

    .gift-card {
      position: relative;
      /* necesario para el overlay */
    }

    .gift-card {
      background: white;
      border-radius: 30px;
      border: 3px solid #d1e0a3;
      overflow: hidden;
      text-align: center;
      transition: 0.3s;
      display: flex;
      flex-direction: column;
      padding-bottom: 15px;
    }

    .gift-card:hover {
      transform: translateY(-5px);
    }

    .gift-card.reserved::after {
      content: "RESERVADO";
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) rotate(-35deg);
      font-size: 2.2rem;
      font-weight: 900;
      color: rgba(92, 64, 51, 0.25);
      /* marr√≥n suave */
      letter-spacing: 4px;
      pointer-events: none;
      /* no bloquea clicks */
      white-space: nowrap;
      z-index: 5;
    }

    .gift-image {
      height: 120px;
      background: #f1f8e9;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 50px;
      border-bottom: 3px dashed var(--shrek-green);
    }

    .gift-info {
      padding: 15px;
      flex-grow: 1;
      display: flex;
      flex-direction: column;
    }

    .gift-info h3 {
      font-family: "Fredoka One", cursive;
      color: var(--swamp-dark);
      margin: 0 0 10px 0;
      font-size: 1.2rem;
    }

    .options-container {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 10px;
    }

    .btn-option {
      background-color: var(--soft-green);
      color: var(--brown-vest);
      text-decoration: none;
      padding: 8px;
      border-radius: 15px;
      font-size: 0.85rem;
      font-weight: bold;
      border: 2px solid var(--shrek-green);
      transition: 0.3s;
    }

    .btn-option:hover {
      background-color: var(--shrek-green);
    }

    .btn-manual {
      background-color: var(--brown-vest);
      color: white;
      padding: 10px;
      border-radius: 15px;
      font-size: 0.9rem;
      text-decoration: none;
      margin-top: 10px;
      display: block;
    }

    footer {
      text-align: center;
      padding: 40px;
      background: var(--brown-vest);
      color: var(--shrek-green);
    }

    .main-banner {
      background: url("banner.webp") center center;
      background-size: cover;
      /* no recorta */
      background-color: var(--shrek-green);
      /* relleno si sobra espacio */
      height: 350px;
      /* m√°s delgado (ajusta a gusto) */
      width: 100%;
      border-bottom: 8px solid var(--brown-vest);
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
    }

    .gift-image {
      height: 120px;
      background: #f1f8e9;
      display: flex;
      align-items: center;
      justify-content: center;
      border-bottom: 3px dashed var(--shrek-green);
      overflow: hidden;
    }

    .gift-image img {
      max-width: 90%;
      max-height: 90%;
      object-fit: contain;
      /* no recorta */
    }

    /* Ajuste para que en celulares no se vea tan alto y se aprecie mejor el letrero */
    @media (max-width: 600px) {
      .main-banner {
        height: 90px;
        /* m√°s delgado en celular */
        background-size: contain;
        /* igual, sin recorte */
      }
    }

    @keyframes bounceIn {
      0% {
        transform: scale(0.5);
        opacity: 0;
      }

      100% {
        transform: scale(1);
        opacity: 1;
      }
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    const SUPABASE_URL = "https://ideihchzrusccpmlhuni.supabase.co";
    const SUPABASE_ANON_KEY =
      "sb_publishable_LeZHRjAgxjzxM1uV9KYNbQ_0cmiuUDw";
    supabase = window.supabase.createClient(
      SUPABASE_URL,
      SUPABASE_ANON_KEY,
    );

    async function reserveGift(id, btn) {
      const ok = confirm(
        "¬øEst√°s seguro de que quieres reservar esta sugerencia?",
      );
      if (!ok) return;

      btn.disabled = true;

      const BROWSER_ID = getBrowserId();

      console.log("Intentando reservar regalo ID:", id, "con BROWSER_ID:", BROWSER_ID);

      const { data, error } = await supabase
        .from("Lista")
        .update({ reserved: true, reserved_at: new Date().toISOString(), reserved_by_browser_id: BROWSER_ID })
        .eq("id", id)
        .eq("reserved", false)
        .select("id");

      if (error || !data || data.length === 0) {
        alert("No se pudo reservar (ya est√° reservado o no permitido).");
        btn.disabled = false;
        return;
      }

      const card = btn.closest(".gift-card");
      if (card) {
        card.classList.add("reserved");
        card.style.opacity = "0.55";
        card.style.filter = "grayscale(1)";
      }

      btn.textContent = "Reservado";
    }

    function escapeHtml(s) {
      return String(s ?? "")
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");
    }

    function buildLinks(g) {
      const pairs = [
        { name: g.nombre_1, link: g.link_1 },
        { name: g.nombre_2, link: g.link_2 },
        { name: g.nombre_3, link: g.link_3 },
      ];

      return pairs
        .filter((x) => x.name && x.link)
        .map(
          (x) => `
          <a href="${escapeHtml(x.link)}" target="_blank" class="btn-option">
            ${escapeHtml(x.name)}
          </a>
        `,
        )
        .join("");
    }

    function buildImage(g) {
      const src = `imgs/webp/${escapeHtml(g.id)}.webp`;
      const alt = escapeHtml(g.title ?? g.nombre ?? g.id);

      return `<img src="${src}" alt="${alt}" onerror="this.src='imgs/placeholder.webp'" />`;
    }


    function renderGiftCard(g) {
      const title = g.title ?? g.nombre ?? "Sugerencia";

      const reservedClass = g.reserved ? " reserved" : "";
      const reservedStyle = g.reserved
        ? ' style="opacity:0.55;filter:grayscale(1);"'
        : "";

      const showReserve = g.btn_reserva === true;
      const reserveDisabled = g.reserved ? "disabled" : "";
      const reserveText = g.reserved ? "Reservado" : "Reservar";

      return `
    <div class="gift-card${reservedClass}"${reservedStyle}>
      <div class="gift-image">
        ${buildImage(g)}
      </div>

      <div class="gift-info">
        <h3>${escapeHtml(title)}</h3>

        <div class="options-container">
          ${buildLinks(g)}
          ${showReserve
          ? `<button class="btn-option"
                         data-gift-id="${escapeHtml(g.id)}"
                         onclick="reserveGift('${escapeHtml(g.id)}', this)"
                         ${reserveDisabled}>
                   ${reserveText}
                 </button>`
          : ""
        }
        </div>
      </div>
    </div>
  `;
    }

    function getBrowserId() {
      let id = localStorage.getItem("ls_browser_id");
      if (!id) {
        id = (crypto.randomUUID ? crypto.randomUUID() : String(Date.now()) + Math.random());
        localStorage.setItem("ls_browser_id", id);
      }
      return id;
    }

    const BROWSER_ID = getBrowserId();
    console.log("BROWSER_ID:", BROWSER_ID);


    async function loadGifts() {

      const grid = document.getElementById("giftGrid");

      if (!grid) return;

      const { data, error } = await supabase
        .from("Lista")
        .select(
          "id,title,link_1,link_2,link_3,nombre_1,nombre_2,nombre_3,reserved,btn_reserva",
        )
        .order("orden", { ascending: true }); // si no tienes 'orden', elimina esta l√≠nea

      console.log('data:', data);

      if (error) {
        console.error(error);
        grid.innerHTML =
          "<p style='text-align:center'>No se pudo cargar la lista.</p>";
        return;
      }

      grid.innerHTML = (data ?? []).map(renderGiftCard).join("");
    }

    window.addEventListener("load", loadGifts);
  </script>
</head>

<body>
  <div class="modal-overlay" id="welcomeModal">
    <div class="modal-content">
      <img src="bebe_shrek.png" alt="Shrek Baby" />
      <p>
        <b>T√≠os y t√≠as</b>, junto a mis papis les dejamos algunas sugerencias;
        pero queremos que sepan que todo lo que nos regalen con cari√±o ser√°
        recibido como una bendici√≥n.
      </p>
      <button class="btn-option" onclick="closeModal()" style="cursor: pointer; padding: 10px 20px">
        ¬°Entrar al Pantano!
      </button>
    </div>
  </div>

  <header class="main-banner"></header>

  <div class="container">
    <div style="text-align: center; margin-bottom: 20px">
      <h1 style="
            font-family: &quot;Fredoka One&quot;;
            color: var(--shrek-green);
            text-shadow: 2px 2px var(--brown-vest);
          ">
        LISTA DE SUGERENCIAS
      </h1>
    </div>

    <div class="sugerencia-container">
      <p class="sugerencia-text">
        Las sugerencias que les dejamos pueden encontrarlas en su tienda
        favorita, desde la m√°s elegante hasta la m√°s caserita‚Ä¶ ¬°todo vale!
        <br /><br />
        Las referencias son solo una gu√≠a, as√≠ que pueden ir al mercado, la
        cachina, el hueco o donde el coraz√≥n (y el bolsillo) los lleve üòÑ
        <br /><br />
        Sabemos que algunos regalitos pueden ser un poquito m√°s costosos, por
        eso tambi√©n les dejamos la idea de que, si desean, pueden juntarse
        entre varios para regalarnos algo con mucho cari√±o.
      </p>
    </div>

    <div class="gift-grid" id="giftGrid">



    </div>

    <footer>
      <p>¬°Los esperamos en el pantano con mucho cari√±o! ‚Ä¢ 2026</p>
    </footer>

    <script>
      //window.onload = () =>(document.getElementById("welcomeModal").style.display = "flex");
      const closeModal = () =>
        (document.getElementById("welcomeModal").style.display = "none");
    </script>
</body>

</html>
